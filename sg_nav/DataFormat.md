# Data Format Documentation
This document is to record the data generated by repository code, used for following navigation tasks.

## Instance segmentation 
`{scene_name}_pclseg.txt` is the file of instance segmentation for point clouds. For example, file `17DRP5sb8fy_pclseg.txt`:
```
0
2
2
5
15
...
```
contains N lines, where N is the number of vertices in `17DRP5sb8fy_semantic.ply` mesh file. Each line is the object id the vertex point belongs to. 

## Vertex normals
`{scene_name}_normals.npy` is the file of vertex normals. It contains a numpy array with shape (N,3) where N is the number of vertices in `17DRP5sb8fy_semantic.ply` mesh file.

## Geodesic distance & Shortest paths
After running [gen_shortest_path.py](./dataset/habitat/gen_shortest_path.py), there will be a `shortest_paths` directory under each scene. The directory structure is (take scene 17DRP5sb8fy as example): 
```
|-17DRP5sb8fy
|--|-17DRP5sb8fy.glb
|--|-17DRP5sb8fy_semantic.ply
|--|- ... 
|--|-shortest_paths
|--|--|-geomap_meta.pickle
|--|--|-geomap_object_0.pickle
|--|--|-geomap_object_1.pickle
|--|--|- ...
|--|--|-geomap_object_M.pickle
```
The `geomap_meta.pickle` file stores the meta information of this scene:
```
{
    "scene_boundary": # scene boundary in habitat coordinate frame
    "meters_per_grid": # grid size in meter
    "grid_segmentation": # matrix containing free space grid map with value indicating region segmentation (val=0 means obstacle)  
    "free_grid_idx": # list of (row, col) indices that keeps the same order of 'shortest path dict' in geomap_object_X.pickle file
    "free_space_points": # list of (x, y, z) coordinates under habitat frame that keeps the same order of 'shortest path dict' in geomap_object_X.pickle file
    "object_ids": object ids contained by this scene, [0,1,...,M]
}
```
The `geomap_object_X.pickle` file stores the geodesic map and shortest paths when taking object X as the target end point:
```
{
    "object_id": # target object id  
    "end": # (x,y,z) coords of end point under habitat coords system
    "end_exact": # if true, the end point of the trajectory is the exact object center; otherwise the end point is clipped to the closest reachable position in the free space. 
    "geodesic_dist_map": the geodesic map starting from all free space grid points, ending at the target object X, with `inf` indicating either there is no path or the grid point is not in free space. 
    "shortest_path_list": [...], list of 'shortest_path_dict'
}
```
`shortest_path_dict`:
```
{
    "start": # (x,y,z) coords of starting point under habitat coords system
    "start_exact": same meaning with 'end_exact'
    "found_path": if true, there is a valid shortest path found, otherwise the 'end' is not reachable from 'start'
    "geodesic_distance":geodesic distance
    "path_points": [(x1,y1,z1), ..., (xk,yk,zk)] trajectory of shortest path, under habitat coords system
}
```
